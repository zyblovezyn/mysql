
SET @@sql_mode='';

-- 省局人员 总的接入率
SELECT
     a.org_name, SUM(a.countrate) AS countrate, SUM(a.accessrate) AS accessrate, SUM(a.countrate) - SUM(a.accessrate) AS noaccessrate
FROM
     (SELECT
          sum1.org_name, SUM(org.countrate) AS countrate, 0 AS accessrate
     FROM
          (SELECT
               CASE
                    sum1.p_org_no
                    WHEN '8a812897493378a001495677ad086663'
                    THEN '1096FA0035D17535E05379FB31210000'
                    ELSE sum1.p_org_no
               END AS p_org_no, SUM(org.countrate) AS countrate
          FROM
               (SELECT
                    org.org_no, org.org_name, COUNT(DISTINCT s.id) AS countrate
               FROM
                    cisp_dev.yc_substation s
                    INNER JOIN base.bp_org_shortname org
                         ON org.org_no = s.depart
               WHERE 1 = 1
                    AND s.depart IN (
                         '$', '8a812897493378a001495677ad086663', '1096FA0035D17535E05379FB00200000', '1096FA0035D17535E05379FB00300000', '1096FA0035D17535E05379FB20000001', '1096FA0035D17535E05379FB21001100', '1096FA0035D17535E05379FB21001110', '1096FA0035D17535E05379FB21001121', '1096FA0035D17535E05379FB21001130', '1096FA0035D17535E05379FB21001140', '1096FA0035D17535E05379FB21001160', '1096FA0035D17535E05379FB21001161', '1096FA0035D17535E05379FB31000001', '1096FA0035D17535E05379FB31210000', '1096FA0035D17535E05379FB32000001', '1096FA0035D17535E05379FB33000001', '1096FA0035D17535E05379FB34000001', '1096FA0035D17535E05379FB35000001', '1096FA0035D17535E05379FB36000001', '1096FA0035D17535E05379FB37000000', '1096FA0035D17535E05379FB38010000', '1096FA0035D17535E05379FB42000000', '1096FA0035D17535E05379FB47000000', '1096FA0035D17535E05379FB48000000', '1096FA0035D17535E05379FB50005475', '1096FA0035D17535E05379FB50006001', '8a127803551645a40156bb8b01b24f59', 'ff808081551645d1015590d17bbd437f', '国网浙江省置业公司', '1096FA0035D17535E05379FB00240000', '1096FA0035D17535E05379FB00255000', '1096FA0035D17535E05379FB00260000', '1096FA0035D17535E05379FB00265000', '1096FA0035D17535E05379FB00270000', '1096FA0035D17535E05379FB50152705', '1096FA0035D17535E05379FB00368888', '1096FA0035D17535E05379FB00370000', '1096FA0035D17535E05379FB00380000', '1096FA0035D17535E05379FB00390000', '1096FA0035D17535E05379FB50151626', '1096FA0035D17535E05379FB21001001', '1096FA0035D17535E05379FB21001002', '1096FA0035D17535E05379FB36661007', '1096FA0035D17535E05379FB36661008', '1096FA0035D17535E05379FB31510001', '1096FA0035D17535E05379FB31520001', '1096FA0035D17535E05379FB31531000', '1096FA0035D17535E05379FB31540001', '1096FA0035D17535E05379FB31550001', '1096FA0035D17535E05379FB31560001', '1096FA0035D17535E05379FB31570001', '1096FA0035D17535E05379FB50152672', '8a1278036043716701608bbb873c2e52', '1096FA0035D17535E05379FB32700000', '1096FA0035D17535E05379FB32800000', '1096FA0035D17535E05379FB32900000', '1096FA0035D17535E05379FB50152125', '1096FA0035D17535E05379FB33910000', '1096FA0035D17535E05379FB33920001', '1096FA0035D17535E05379FB33930001', '1096FA0035D17535E05379FB33940001', '1096FA0035D17535E05379FB33950001', '1096FA0035D17535E05379FB33960001', '1096FA0035D17535E05379FB50152150', '1096FA0035D17535E05379FB34810001', '1096FA0035D17535E05379FB34829999', '1096FA0035D17535E05379FB34830001', '1096FA0035D17535E05379FB34840000', '1096FA0035D17535E05379FB34859999', '1096FA0035D17535E05379FB34860100', '1096FA0035D17535E05379FB34870000', '1096FA0035D17535E05379FB34880001', '1096FA0035D17535E05379FB34890000', '1096FA0035D17535E05379FB50152940', '1096FA0035D17535E05379FB35030000', '1096FA0035D17535E05379FB35040000', '1096FA0035D17535E05379FB35050000', '1096FA0035D17535E05379FB35060000', '1096FA0035D17535E05379FB35070000', '1096FA0035D17535E05379FB35080000', '1096FA0035D17535E05379FB35090000', '1096FA0035D17535E05379FB50151460', '1096FA0035D17535E05379FB36661001', '1096FA0035D17535E05379FB36662001', '1096FA0035D17535E05379FB36663001', '1096FA0035D17535E05379FB36664001', '1096FA0035D17535E05379FB50152684', '1096FA0035D17535E05379FB37007001', '1096FA0035D17535E05379FB37010001', '1096FA0035D17535E05379FB37012501', '1096FA0035D17535E05379FB37015001', '1096FA0035D17535E05379FB37017501', '1096FA0035D17535E05379FB37020001', '1096FA0035D17535E05379FB37022501', '1096FA0035D17535E05379FB37025001', '1096FA0035D17535E05379FB37030001', '1096FA0035D17535E05379FB37999999', '1096FA0035D17535E05379FB25000001', '1096FA0035D17535E05379FB26000001', '1096FA0035D17535E05379FB27000001', '1096FA0035D17535E05379FB38900000', '1096FA0035D17535E05379FB38920000', '1096FA0035D17535E05379FB38941000', '1096FA0035D17535E05379FB38960000', '1096FA0035D17535E05379FB38980000', '1096FA0035D17535E05379FB50152618', '1096FA0035D17535E05379FB50154611', '1096FA0035D17535E05379FB48210001', '1096FA0035D17535E05379FB48220002', '1096FA0035D17535E05379FB50153253'
                    )
               GROUP BY org.org_no) AS org
               INNER JOIN base.bp_org_shortname sum1
                    ON org.org_no = sum1.org_no
          GROUP BY sum1.p_org_no) AS org
          INNER JOIN base.bp_org_shortname sum1
               ON org.p_org_no = sum1.org_no
     GROUP BY sum1.org_no
     UNION
     ALL -- 接入率
      SELECT
          sum1.org_name, 0 AS countrate, SUM(org.accessrate) AS accessrate
     FROM
          (SELECT
               CASE
                    org.p_org_no
                    WHEN '8a812897493378a001495677ad086663'
                    THEN '1096FA0035D17535E05379FB31210000'
                    ELSE org.p_org_no
               END AS p_org_no, org.org_name, SUM(v.accessrate) AS accessrate
          FROM
               (SELECT DISTINCT
                    COUNT(DISTINCT s.id) AS accessrate, s.DEPART
               FROM
                    cisp_dev.yc_substation s
                    LEFT JOIN cisp_dev.v_all_dev d
                         ON s.id = d.substation_id
               WHERE d.ID IS NOT NULL
                    AND s.depart IN (
                         '$', '8a812897493378a001495677ad086663', '1096FA0035D17535E05379FB00200000', '1096FA0035D17535E05379FB00300000', '1096FA0035D17535E05379FB20000001', '1096FA0035D17535E05379FB21001100', '1096FA0035D17535E05379FB21001110', '1096FA0035D17535E05379FB21001121', '1096FA0035D17535E05379FB21001130', '1096FA0035D17535E05379FB21001140', '1096FA0035D17535E05379FB21001160', '1096FA0035D17535E05379FB21001161', '1096FA0035D17535E05379FB31000001', '1096FA0035D17535E05379FB31210000', '1096FA0035D17535E05379FB32000001', '1096FA0035D17535E05379FB33000001', '1096FA0035D17535E05379FB34000001', '1096FA0035D17535E05379FB35000001', '1096FA0035D17535E05379FB36000001', '1096FA0035D17535E05379FB37000000', '1096FA0035D17535E05379FB38010000', '1096FA0035D17535E05379FB42000000', '1096FA0035D17535E05379FB47000000', '1096FA0035D17535E05379FB48000000', '1096FA0035D17535E05379FB50005475', '1096FA0035D17535E05379FB50006001', '8a127803551645a40156bb8b01b24f59', 'ff808081551645d1015590d17bbd437f', '国网浙江省置业公司', '1096FA0035D17535E05379FB00240000', '1096FA0035D17535E05379FB00255000', '1096FA0035D17535E05379FB00260000', '1096FA0035D17535E05379FB00265000', '1096FA0035D17535E05379FB00270000', '1096FA0035D17535E05379FB50152705', '1096FA0035D17535E05379FB00368888', '1096FA0035D17535E05379FB00370000', '1096FA0035D17535E05379FB00380000', '1096FA0035D17535E05379FB00390000', '1096FA0035D17535E05379FB50151626', '1096FA0035D17535E05379FB21001001', '1096FA0035D17535E05379FB21001002', '1096FA0035D17535E05379FB36661007', '1096FA0035D17535E05379FB36661008', '1096FA0035D17535E05379FB31510001', '1096FA0035D17535E05379FB31520001', '1096FA0035D17535E05379FB31531000', '1096FA0035D17535E05379FB31540001', '1096FA0035D17535E05379FB31550001', '1096FA0035D17535E05379FB31560001', '1096FA0035D17535E05379FB31570001', '1096FA0035D17535E05379FB50152672', '8a1278036043716701608bbb873c2e52', '1096FA0035D17535E05379FB32700000', '1096FA0035D17535E05379FB32800000', '1096FA0035D17535E05379FB32900000', '1096FA0035D17535E05379FB50152125', '1096FA0035D17535E05379FB33910000', '1096FA0035D17535E05379FB33920001', '1096FA0035D17535E05379FB33930001', '1096FA0035D17535E05379FB33940001', '1096FA0035D17535E05379FB33950001', '1096FA0035D17535E05379FB33960001', '1096FA0035D17535E05379FB50152150', '1096FA0035D17535E05379FB34810001', '1096FA0035D17535E05379FB34829999', '1096FA0035D17535E05379FB34830001', '1096FA0035D17535E05379FB34840000', '1096FA0035D17535E05379FB34859999', '1096FA0035D17535E05379FB34860100', '1096FA0035D17535E05379FB34870000', '1096FA0035D17535E05379FB34880001', '1096FA0035D17535E05379FB34890000', '1096FA0035D17535E05379FB50152940', '1096FA0035D17535E05379FB35030000', '1096FA0035D17535E05379FB35040000', '1096FA0035D17535E05379FB35050000', '1096FA0035D17535E05379FB35060000', '1096FA0035D17535E05379FB35070000', '1096FA0035D17535E05379FB35080000', '1096FA0035D17535E05379FB35090000', '1096FA0035D17535E05379FB50151460', '1096FA0035D17535E05379FB36661001', '1096FA0035D17535E05379FB36662001', '1096FA0035D17535E05379FB36663001', '1096FA0035D17535E05379FB36664001', '1096FA0035D17535E05379FB50152684', '1096FA0035D17535E05379FB37007001', '1096FA0035D17535E05379FB37010001', '1096FA0035D17535E05379FB37012501', '1096FA0035D17535E05379FB37015001', '1096FA0035D17535E05379FB37017501', '1096FA0035D17535E05379FB37020001', '1096FA0035D17535E05379FB37022501', '1096FA0035D17535E05379FB37025001', '1096FA0035D17535E05379FB37030001', '1096FA0035D17535E05379FB37999999', '1096FA0035D17535E05379FB25000001', '1096FA0035D17535E05379FB26000001', '1096FA0035D17535E05379FB27000001', '1096FA0035D17535E05379FB38900000', '1096FA0035D17535E05379FB38920000', '1096FA0035D17535E05379FB38941000', '1096FA0035D17535E05379FB38960000', '1096FA0035D17535E05379FB38980000', '1096FA0035D17535E05379FB50152618', '1096FA0035D17535E05379FB50154611', '1096FA0035D17535E05379FB48210001', '1096FA0035D17535E05379FB48220002', '1096FA0035D17535E05379FB50153253'
                    )
               GROUP BY s.DEPART) AS v
               LEFT JOIN base.bp_org_shortname org
                    ON v.depart = org.org_no
          GROUP BY org.p_org_no) AS org
          INNER JOIN base.bp_org_shortname sum1
               ON sum1.org_no = org.p_org_no
     GROUP BY sum1.org_no) a
GROUP BY a.org_name









SELECT * FROM base.bp_org_shortname WHERE org_name LIKE '%省检%'
UPDATE base.bp_org_shortname SET org_name='省检' WHERE org_no='1096FA0035D17535E05379FB31210000'